<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ga-tracking-framework tests</title>
  <link rel="stylesheet" href="https://code.jquery.com/qunit/qunit-2.0.1.css">
  <script src="../node_modules/jquery/dist/jquery.min.js"></script>
</head>
<body>
  <div id="qunit"></div>
  <div id="qunit-fixture"></div>
  <script src="../node_modules/jquery/dist/jquery.min.js"></script>
  <script src="https://code.jquery.com/qunit/qunit-2.0.1.js"></script>
  <script src="../resources/js/DeclarativeTracking.js"></script>
  <script>
    QUnit.test( "a basic test example", function( assert ) {
      var value = "hello";
      assert.equal( value, "hello", "We expect value to be hello" );
    });

    QUnit.test( "DeclarativeTracking.getInstance", function(assert) {
      assert.deepEqual(DeclarativeTracking.getInstance(), DeclarativeTracking.getInstance(), "DeclarativeTracking is a singleton")
    })

    QUnit.test("DeclarativeTracking.registerTrigger", function(assert) {
      DeclarativeTracking.registerTrigger('TestTrigger', function() {});
      assert.notEqual(DeclarativeTracking.getTrigger('TestTrigger'), null, "Can register a trigger");
    });

    QUnit.test("DeclarativeTracking.getTrigger by alias", function(assert) {
      DeclarativeTracking.registerTrigger('TestTrigger', function() {});
      DeclarativeTracking.registerTrigger('TestTrigger2', 'TestTrigger');
      assert.notEqual(DeclarativeTracking.getTrigger('TestTrigger'), DeclarativeTracking.getTrigger('TestTrigger2'), "Trigger aliasses work");
    });

    QUnit.test("DeclarativeTracking.registerTracker", function(assert) {
      DeclarativeTracking.registerTracker('TestTracker', function() {});
      assert.notEqual(DeclarativeTracking.getTracker('TestTracker'), null, "Can register a tracker");
    });

    QUnit.test("DeclarativeTracking.getTracker by alias", function(assert) {
      DeclarativeTracking.registerTracker('TestTracker', function() {});
      DeclarativeTracking.registerTracker('TestTracker2', 'TestTracker');
      assert.notEqual(DeclarativeTracking.getTracker('TestTracker'), DeclarativeTracking.getTracker('TestTracker2'), "Tracker aliasses work");
    });

    QUnit.test("DeclarativeTracking.registerStandardTriggers", function(assert) {
      DeclarativeTracking.registerStandardTriggers();
      assert.notEqual(DeclarativeTracking.getTrigger('jquery'), null, "jquery included in standard triggers");
    })

    QUnit.test("DeclarativeTracking.registerStandardTrackers", function(assert) {
      DeclarativeTracking.registerStandardTrackers();
      assert.notEqual(DeclarativeTracking.getTracker('google-analytics'), null, "google-analytics included in standard trackers");
    })

    QUnit.test('DeclarativeTracking.init', function(assert) {
      DeclarativeTracking.init();
      assert.notEqual(DeclarativeTracking.getTrigger('jquery'), null, "jquery included in standard triggers");
      assert.notEqual(DeclarativeTracking.getTracker('google-analytics'), null, "google-analytics included in standard trackers");
    })

    QUnit.test('DeclarativeTracking.bindTrackers', function(assert) {

      var stubTracker = function(element) { result = true },
          stubTrigger = function(element, tracker) { tracker(element) },
          result = false;

      (function(parent) {

        parent.append('<a data-track="stub-trigger" data-track-service="stub-track-service"></a>')

      })($('#qunit-fixture'))

      DeclarativeTracking.init();
      DeclarativeTracking.registerTrigger('stub-trigger', stubTrigger)
      DeclarativeTracking.registerTracker('stub-track-service', stubTracker)
      DeclarativeTracking.bindTrackers()

      assert.ok(result, "Binding trackers ok")

    })
  </script>
</body>
</html>